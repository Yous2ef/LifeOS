import{j as e}from"./radix-ui-CneFSYrq.js";import{c as I,B as w,I as D}from"./index-Bxm5_NB2.js";import{m as j,G as W}from"./GlassCard-BanqmBZf.js";import{a as R,a1 as q,d as M,C as S,P as T,af as U,X as F,ac as Y,an as G,W as H,I as Q,b as L,ak as X,al as B,am as _,s as J,ao as K}from"./utils-C1zQmt0N.js";import{L as V,r as k}from"./router-CJK1Z2Io.js";import{L as y}from"./Label-9bh_qwHc.js";import{T as E}from"./TextArea-CYEI4xSa.js";import{A as $}from"./SkeletonCard-B2hvjRDr.js";const z=({installment:o,formatCurrency:c,onClick:u,onPay:s,className:g})=>{const m=o.paidInstallments/o.totalInstallments*100,p=o.status==="completed",t=o.status==="overdue",i=Math.ceil((new Date(o.nextPaymentDate).getTime()-Date.now())/(1e3*60*60*24)),x=p?"#22c55e":t?"#ef4444":i<=3?"#f59e0b":"#3b82f6";return e.jsxs(j.div,{whileHover:{scale:1.01},whileTap:{scale:.99},onClick:u,className:I("p-4 rounded-2xl","bg-card/50 border border-border/50","cursor-pointer transition-all duration-200","hover:shadow-md hover:border-primary/30",t&&"border-rose-500/50 bg-rose-500/5",g),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-sm truncate",children:o.title}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[c(o.installmentAmount)," /"," ",o.frequency]})]}),e.jsx("div",{className:I("flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium",p&&"bg-emerald-500/10 text-emerald-500",t&&"bg-rose-500/10 text-rose-500",!p&&!t&&"bg-blue-500/10 text-blue-500"),children:p?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-3 h-3"}),"Done"]}):t?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-3 h-3"}),"Overdue"]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-3 h-3"}),i<=0?"Today":`${i}d`]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-muted/50 rounded-full overflow-hidden",children:e.jsx(j.div,{initial:{width:0},animate:{width:`${m}%`},transition:{duration:.6,ease:"easeOut"},className:"h-full rounded-full relative overflow-hidden",style:{backgroundColor:x,boxShadow:`0 0 12px ${x}40`},children:!p&&e.jsx(j.div,{animate:{x:["0%","200%"]},transition:{duration:2,repeat:1/0,ease:"linear"},className:"absolute inset-0 w-1/2 bg-gradient-to-r from-transparent via-white/30 to-transparent skew-x-12"})})}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-muted-foreground",children:[o.paidInstallments," of"," ",o.totalInstallments," paid"]}),e.jsxs("span",{className:"font-medium tabular-nums",style:{color:x},children:[c(o.paidAmount)," /"," ",c(o.totalAmount)]})]})]}),!p&&s&&e.jsxs(w,{size:"sm",variant:"outline",onClick:N=>{N.stopPropagation(),s()},className:I("w-full mt-3 rounded-xl h-9 text-xs font-medium",t?"border-rose-500/50 text-rose-500 hover:bg-rose-500/10":"border-primary/50 text-primary hover:bg-primary/10"),children:["Pay ",c(o.installmentAmount)]})]})},de=({installments:o,formatCurrency:c,onInstallmentClick:u,onPay:s,onAddInstallment:g,className:m,maxInstallments:p})=>{const t=o.filter(d=>d.status!=="completed").sort((d,h)=>d.status==="overdue"&&h.status!=="overdue"?-1:h.status==="overdue"&&d.status!=="overdue"?1:new Date(d.nextPaymentDate).getTime()-new Date(h.nextPaymentDate).getTime()),i=o.filter(d=>d.status==="completed"),n=p?t.slice(0,p):t,x=p&&t.length>p,N=t.reduce((d,h)=>d+(h.totalAmount-h.paidAmount),0);return o.length===0?e.jsx(W,{intensity:"light",padding:"lg",className:I("text-center",m),children:e.jsxs("div",{className:"py-6",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 mx-auto mb-4 flex items-center justify-center",children:e.jsx(S,{className:"w-8 h-8 text-primary"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Installments"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Track your payment plans here"}),g&&e.jsxs(w,{onClick:g,className:"rounded-full gap-2",children:[e.jsx(T,{className:"w-4 h-4"}),"Add Installment"]})]})}):e.jsxs("div",{className:I("space-y-4",m),children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold",children:"Installments"}),e.jsxs("span",{className:"text-xs text-muted-foreground bg-muted/50 px-2 py-0.5 rounded-full",children:[t.length," active"]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[N>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:"Remaining:"}),e.jsx("span",{className:"font-semibold text-rose-500 tabular-nums",children:c(N)})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:"Monthly:"}),e.jsx("span",{className:"font-semibold tabular-nums",children:c(t.reduce((d,h)=>d+h.installmentAmount,0))})]})]}),g&&!x&&e.jsxs(w,{size:"sm",variant:"ghost",onClick:g,className:"rounded-full gap-1 h-7 px-2",children:[e.jsx(T,{className:"w-4 h-4"}),"Add"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[n.map((d,h)=>e.jsx(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:h*.05},children:e.jsx(z,{installment:d,formatCurrency:c,onClick:()=>u?.(d),onPay:()=>s?.(d.id)})},d.id)),x&&e.jsx(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:n.length*.05},children:e.jsx(V,{to:"/finance/installments",className:I("flex items-center justify-between p-4 rounded-2xl","border-2 border-dashed border-violet-500/30","text-violet-500","hover:border-violet-500/50 hover:bg-violet-500/5","transition-all duration-200"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-violet-500/10 flex items-center justify-center",children:e.jsx(U,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"See All Installments"}),e.jsxs("p",{className:"text-xs text-violet-500/70",children:[t.length," active"]})]})]})})})]}),i.length>0&&!p&&e.jsx("div",{className:"pt-2",children:e.jsxs("details",{className:"group",children:[e.jsxs("summary",{className:"text-sm text-muted-foreground cursor-pointer hover:text-foreground transition-colors list-none flex items-center gap-2",children:[e.jsxs("span",{children:["âœ… ",i.length," completed installment",i.length!==1?"s":""]}),e.jsx("span",{className:"text-xs group-open:rotate-90 transition-transform",children:"â–¶"})]}),e.jsx("div",{className:"mt-3 space-y-3 opacity-60",children:i.map(d=>e.jsx(z,{installment:d,formatCurrency:c,onClick:()=>u?.(d)},d.id))})]})})]})},Z=[{value:"weekly",label:"Weekly"},{value:"bi-weekly",label:"Bi-weekly"},{value:"monthly",label:"Monthly"},{value:"quarterly",label:"Quarterly"},{value:"yearly",label:"Yearly"}],ce=({isOpen:o,onClose:c,onSubmit:u,accounts:s,defaultCurrency:g,installment:m})=>{const p=!!m,[t,i]=k.useState({title:"",totalAmount:0,paidAmount:0,installmentAmount:0,totalInstallments:12,paidInstallments:0,frequency:"monthly",startDate:new Date().toISOString().split("T")[0],nextDueDate:new Date().toISOString().split("T")[0],linkedAccountId:s.find(a=>a.isDefault)?.id,merchant:"",notes:"",currency:g}),[n,x]=k.useState("amount");k.useEffect(()=>{o&&(m?(i({title:m.title,totalAmount:m.totalAmount,paidAmount:m.paidAmount,installmentAmount:m.installmentAmount,totalInstallments:m.totalInstallments,paidInstallments:m.paidInstallments,frequency:m.frequency,startDate:m.startDate,nextDueDate:m.nextPaymentDate,linkedAccountId:m.linkedAccountId,merchant:"",notes:m.description||"",currency:g}),x("amount")):(i({title:"",totalAmount:0,paidAmount:0,installmentAmount:0,totalInstallments:12,paidInstallments:0,frequency:"monthly",startDate:new Date().toISOString().split("T")[0],nextDueDate:new Date().toISOString().split("T")[0],linkedAccountId:s.find(a=>a.isDefault)?.id,merchant:"",notes:"",currency:g}),x("amount")))},[o,g,s,m]),k.useEffect(()=>{if(t.totalAmount>0&&t.totalInstallments>0){const a=t.totalAmount-t.paidAmount,r=t.totalInstallments-t.paidInstallments;r>0&&i(A=>({...A,installmentAmount:Math.ceil(a/r)}))}},[t.totalAmount,t.totalInstallments,t.paidAmount,t.paidInstallments]);const N=()=>{!t.title||t.totalAmount<=0||t.totalInstallments<=0||(u(t),c())},d=t.totalInstallments>0?t.paidInstallments/t.totalInstallments*100:0,h=t.totalAmount-t.paidAmount;return e.jsx($,{children:o&&e.jsxs(e.Fragment,{children:[e.jsx(j.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:c,className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50"}),e.jsx(j.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",damping:25,stiffness:300},onClick:a=>a.stopPropagation(),className:"fixed inset-x-4 top-[10%] md:inset-x-auto md:left-1/2 md:-translate-x-1/2 md:w-full md:max-w-lg z-[51]",children:e.jsxs("div",{className:"bg-card/95 backdrop-blur-xl border border-border/50 rounded-3xl shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-2xl bg-violet-500/20 flex items-center justify-center",children:e.jsx(S,{className:"w-5 h-5 text-violet-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:p?"Edit Installment":"New Installment"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n==="amount"?"Set the total":n==="schedule"?"Payment schedule":"Final details"})]})]}),e.jsx("button",{onClick:c,title:"Close",className:"w-8 h-8 rounded-full bg-muted flex items-center justify-center hover:bg-muted/80 transition-colors",children:e.jsx(F,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex gap-1 px-4 pt-4",children:["amount","schedule","details"].map((a,r)=>e.jsx("div",{className:I("flex-1 h-1 rounded-full transition-all",n==="amount"&&r===0||n==="schedule"&&r<=1||n==="details"&&r<=2?"bg-violet-500":"bg-muted")},a))}),e.jsxs("div",{className:"p-4 space-y-4 max-h-[60vh] overflow-y-auto",children:[n==="amount"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs(y,{className:"text-xs text-muted-foreground mb-2 flex items-center gap-2",children:[e.jsx(Y,{className:"w-3 h-3"}),"What are you paying for?"]}),e.jsx(D,{value:t.title,onChange:a=>i(r=>({...r,title:a.target.value})),placeholder:"e.g., MacBook Pro, Car Loan, Phone",className:"rounded-xl",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx(y,{className:"text-xs text-muted-foreground mb-2 block",children:"Total Amount"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-muted-foreground",children:t.currency}),e.jsx(D,{type:"number",value:t.totalAmount||"",onChange:a=>i(r=>({...r,totalAmount:parseFloat(a.target.value)||0})),placeholder:"0.00",className:"rounded-xl pl-14 text-lg font-semibold"})]})]}),e.jsxs("div",{children:[e.jsx(y,{className:"text-xs text-muted-foreground mb-2 block",children:"Already Paid (optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-muted-foreground",children:t.currency}),e.jsx(D,{type:"number",value:t.paidAmount||"",onChange:a=>i(r=>({...r,paidAmount:parseFloat(a.target.value)||0})),placeholder:"0.00",className:"rounded-xl pl-14"})]})]}),e.jsxs("div",{children:[e.jsx(y,{className:"text-xs text-muted-foreground mb-2 block",children:"Merchant / Store (optional)"}),e.jsx(D,{value:t.merchant||"",onChange:a=>i(r=>({...r,merchant:a.target.value})),placeholder:"e.g., Apple Store, Bank, Dealership",className:"rounded-xl"})]})]}),n==="schedule"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 bg-violet-500/10 rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:t.title||"Installment"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t.paidInstallments,"/",t.totalInstallments," ","paid"]})]}),e.jsx("div",{className:"h-3 bg-muted/50 rounded-full overflow-hidden",children:e.jsx(j.div,{initial:{width:0},animate:{width:`${d}%`},transition:{duration:.5,ease:"easeOut"},className:"h-full bg-violet-500 rounded-full"})}),e.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[t.currency," ",t.paidAmount.toLocaleString()," ","paid"]}),e.jsxs("span",{children:[t.currency," ",h.toLocaleString()," ","remaining"]})]})]}),e.jsxs("div",{children:[e.jsx(y,{className:"text-xs text-muted-foreground mb-2 block",children:"Total Installments"}),e.jsx("div",{className:"flex gap-2",children:[3,6,12,24,36].map(a=>e.jsx("button",{onClick:()=>i(r=>({...r,totalInstallments:a})),className:I("flex-1 py-2 rounded-xl text-sm font-medium transition-all",t.totalInstallments===a?"bg-violet-500 text-white":"bg-muted/50 hover:bg-muted"),children:a},a))}),e.jsx(D,{type:"number",value:t.totalInstallments,onChange:a=>i(r=>({...r,totalInstallments:parseInt(a.target.value)||1})),className:"rounded-xl mt-2",min:1})]}),e.jsxs("div",{children:[e.jsx(y,{className:"text-xs text-muted-foreground mb-2 block",children:"Installments Already Paid"}),e.jsx(D,{type:"number",value:t.paidInstallments,onChange:a=>i(r=>({...r,paidInstallments:Math.min(parseInt(a.target.value)||0,t.totalInstallments)})),className:"rounded-xl",min:0,max:t.totalInstallments})]}),e.jsxs("div",{children:[e.jsxs(y,{className:"text-xs text-muted-foreground mb-2 flex items-center gap-2",children:[e.jsx(G,{className:"w-3 h-3"}),"Payment Frequency"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Z.map(a=>e.jsx("button",{onClick:()=>i(r=>({...r,frequency:a.value})),className:I("px-4 py-2 rounded-xl text-sm transition-all",t.frequency===a.value?"bg-violet-500 text-white":"bg-muted/50 hover:bg-muted"),children:a.label},a.value))})]}),e.jsx("div",{className:"p-3 bg-muted/30 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Per installment"}),e.jsxs("span",{className:"text-lg font-semibold text-violet-500",children:[t.currency," ",t.installmentAmount.toLocaleString()]})]})})]}),n==="details"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs(y,{className:"text-xs text-muted-foreground mb-2 flex items-center gap-2",children:[e.jsx(M,{className:"w-3 h-3"}),"Start Date"]}),e.jsx(D,{type:"date",value:t.startDate,onChange:a=>i(r=>({...r,startDate:a.target.value})),className:"rounded-xl"})]}),e.jsxs("div",{children:[e.jsxs(y,{className:"text-xs text-muted-foreground mb-2 flex items-center gap-2",children:[e.jsx(M,{className:"w-3 h-3"}),"Next Payment Due"]}),e.jsx(D,{type:"date",value:t.nextDueDate,onChange:a=>i(r=>({...r,nextDueDate:a.target.value})),className:"rounded-xl"})]}),e.jsxs("div",{children:[e.jsxs(y,{className:"text-xs text-muted-foreground mb-2 flex items-center gap-2",children:[e.jsx(H,{className:"w-3 h-3"}),"Pay From Account"]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:s.filter(a=>a.isActive).map(a=>e.jsxs("button",{onClick:()=>i(r=>({...r,linkedAccountId:a.id})),className:I("flex items-center gap-2 px-4 py-2 rounded-xl whitespace-nowrap transition-all",t.linkedAccountId===a.id?"bg-violet-500/20 ring-2 ring-violet-500":"bg-muted/50 hover:bg-muted"),children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:a.color}}),e.jsx("span",{className:"text-sm font-medium",children:a.name})]},a.id))})]}),e.jsxs("div",{children:[e.jsxs(y,{className:"text-xs text-muted-foreground mb-2 flex items-center gap-2",children:[e.jsx(Q,{className:"w-3 h-3"}),"Notes (optional)"]}),e.jsx(E,{value:t.notes||"",onChange:a=>i(r=>({...r,notes:a.target.value})),placeholder:"Add any notes...",className:"rounded-xl min-h-[80px]"})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-border/50 flex gap-3",children:[n==="amount"&&e.jsxs(e.Fragment,{children:[e.jsx(w,{variant:"outline",onClick:c,className:"flex-1 rounded-xl",children:"Cancel"}),e.jsx(w,{onClick:()=>x("schedule"),disabled:!t.title||t.totalAmount<=0,className:"flex-1 rounded-xl bg-violet-500 hover:bg-violet-600",children:"Continue"})]}),n==="schedule"&&e.jsxs(e.Fragment,{children:[e.jsx(w,{variant:"outline",onClick:()=>x("amount"),className:"flex-1 rounded-xl",children:"Back"}),e.jsx(w,{onClick:()=>x("details"),disabled:t.totalInstallments<=0,className:"flex-1 rounded-xl bg-violet-500 hover:bg-violet-600",children:"Continue"})]}),n==="details"&&e.jsxs(e.Fragment,{children:[e.jsx(w,{variant:"outline",onClick:()=>x("schedule"),className:"flex-1 rounded-xl",children:"Back"}),e.jsx(w,{onClick:N,className:"flex-1 rounded-xl bg-violet-500 hover:bg-violet-600",children:"Create Installment"})]})]}),t.title&&t.totalAmount>0&&e.jsx("div",{className:"px-4 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between p-3 bg-violet-500/10 rounded-xl text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4 text-violet-500"}),e.jsx("span",{className:"font-medium",children:t.title})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-violet-500",children:[t.currency," ",t.installmentAmount.toLocaleString(),"/mo"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[t.totalInstallments-t.paidInstallments," ","payments left"]})]})]})})]})})]})})},me=({isOpen:o,onClose:c,installment:u,formatCurrency:s,onEdit:g,onPay:m,onRefund:p})=>{if(!u)return null;const t=Math.min(u.paidAmount/u.totalAmount*100,100),i=u.totalAmount-u.paidAmount,n=u.status==="completed"||t>=100,x=[...u.payments||[]].sort((l,b)=>new Date(b.date).getTime()-new Date(l.date).getTime()),N=l=>{const b=new Date(l);return b.toLocaleDateString("en-US",{day:"numeric",month:"short",year:b.getFullYear()!==new Date().getFullYear()?"numeric":void 0})},d=l=>{switch(l){case"paid":return{color:"#10b981",text:"Paid",icon:R};case"partial":return{color:"#f59e0b",text:"Partial",icon:L};case"late":return{color:"#ef4444",text:"Late",icon:M};case"missed":return{color:"#ef4444",text:"Missed",icon:F};default:return{color:"#6b7280",text:l,icon:S}}},h=140,a=10,r=(h-a)/2,A=r*2*Math.PI,f=A-t/100*A,v="#a855f7";return e.jsx($,{children:o&&e.jsxs(e.Fragment,{children:[e.jsx(j.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:c,className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50"}),e.jsx(j.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},onClick:l=>l.stopPropagation(),className:"fixed inset-x-4 top-[5%] md:inset-auto md:left-1/2 md:top-1/2 md:-translate-x-1/2 md:-translate-y-1/2 md:w-full md:max-w-md z-[51] max-h-[90vh] overflow-hidden flex flex-col",children:e.jsxs("div",{className:"bg-card/95 backdrop-blur-xl rounded-2xl border border-purple-500/20 shadow-2xl shadow-purple-500/10 overflow-hidden flex flex-col max-h-full",children:[e.jsx("div",{className:"px-6 pt-6 pb-4 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center",style:{backgroundColor:`${v}20`},children:e.jsx(S,{className:"w-6 h-6",style:{color:v}})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:u.title}),e.jsxs("p",{className:"text-xs text-muted-foreground capitalize",children:[u.frequency," â€¢"," ",u.status]})]})]}),e.jsx("button",{onClick:c,className:"w-8 h-8 rounded-full bg-muted flex items-center justify-center hover:bg-muted/80 transition-colors",children:e.jsx(F,{className:"w-4 h-4"})})]})}),e.jsx("div",{className:"px-6 pb-4 flex-shrink-0",children:e.jsx("div",{className:"rounded-xl p-4 border",style:{background:`linear-gradient(135deg, ${v}10, ${v}05)`,borderColor:`${v}30`},children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsxs("svg",{width:h,height:h,className:"transform -rotate-90",children:[e.jsx("circle",{cx:h/2,cy:h/2,r,fill:"none",stroke:"currentColor",strokeWidth:a,className:"text-muted/30"}),e.jsx(j.circle,{cx:h/2,cy:h/2,r,fill:"none",stroke:v,strokeWidth:a,strokeLinecap:"round",initial:{strokeDashoffset:A},animate:{strokeDashoffset:f},transition:{duration:1,ease:"easeOut"},style:{strokeDasharray:A}})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsxs("span",{className:"text-2xl font-bold",style:{color:v},children:[Math.round(t),"%"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"paid"})]})]}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Paid"}),e.jsx("span",{className:"font-semibold",style:{color:v},children:s(u.paidAmount)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Remaining"}),e.jsx("span",{className:"font-semibold",children:s(i)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total"}),e.jsx("span",{className:"font-medium text-muted-foreground",children:s(u.totalAmount)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Installments"}),e.jsxs("span",{className:"font-medium text-muted-foreground",children:[u.paidInstallments," ","/"," ",u.totalInstallments]})]}),!n&&u.nextPaymentDate&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground mt-2 pt-2 border-t border-white/10",children:[e.jsx(M,{className:"w-3 h-3"}),e.jsxs("span",{children:["Next:"," ",N(u.nextPaymentDate)]})]})]})]})})}),e.jsxs("div",{className:"px-6 pb-4 flex-1 overflow-hidden flex flex-col min-h-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4",style:{color:v}}),"Payment History"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[x.length," payment",x.length!==1?"s":""]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 scrollbar-thin",children:x.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(S,{className:"w-10 h-10 mx-auto mb-2 opacity-30"}),e.jsx("p",{className:"text-sm",children:"No payments yet"}),e.jsx("p",{className:"text-xs mt-1",children:"Record your first payment!"})]}):x.map((l,b)=>{const C=d(l.status),P=l.amount<0,O=Math.abs(l.amount);return e.jsxs(j.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:b*.05},className:"flex items-center gap-3 p-3 rounded-xl bg-muted/30 border border-border",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:P?"rgba(239, 68, 68, 0.2)":`${C.color}20`},children:P?e.jsx(X,{className:"w-4 h-4 text-red-500"}):e.jsx(T,{className:"w-4 h-4",style:{color:C.color}})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:`font-medium ${P?"text-red-500":""}`,style:P?{}:{color:C.color},children:[P?"-":"+",s(O)]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:N(l.date)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:`${C.color}20`,color:C.color},children:P?"Refund":C.text}),l.notes&&e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:l.notes})]})]})]},l.id)})})]}),e.jsxs("div",{className:"px-6 pb-6 pt-2 flex-shrink-0 border-t border-border space-y-2",children:[e.jsxs("div",{className:"flex gap-3",children:[m&&!n&&e.jsxs(w,{onClick:()=>{c(),m()},className:"flex-1 gap-2",style:{background:`linear-gradient(135deg, ${v}, ${v}cc)`},children:[e.jsx(T,{className:"w-4 h-4"}),"Record Payment"]}),p&&u.paidAmount>0&&e.jsxs(w,{variant:"outline",onClick:()=>{c(),p()},className:"flex-1 gap-2 border-amber-500/30 text-amber-600 dark:text-amber-400 hover:bg-amber-500/10",children:[e.jsx(B,{className:"w-4 h-4"}),"Refund"]})]}),g&&e.jsxs(w,{variant:"ghost",onClick:()=>{c(),g()},className:"w-full gap-2 text-muted-foreground hover:text-foreground",children:[e.jsx(_,{className:"w-4 h-4"}),"Edit Installment"]})]})]})})]})})};function xe({isOpen:o,onClose:c,onSubmit:u,installment:s,formatCurrency:g}){const[m,p]=k.useState(""),[t,i]=k.useState("");k.useEffect(()=>{s&&(p(""),i(""))},[s?.id]);const n=k.useMemo(()=>{const f=parseFloat(m);return isNaN(f)?0:f},[m]),x=k.useMemo(()=>s?Math.max(0,s.paidAmount-n):0,[s,n]),N=k.useMemo(()=>!s||s.totalAmount===0?0:Math.min(100,x/s.totalAmount*100),[s,x]),d=k.useMemo(()=>!s||s.totalAmount===0?0:Math.min(100,s.paidAmount/s.totalAmount*100),[s]),h=n>(s?.paidAmount||0),a=f=>{f.preventDefault(),n>0&&n<=(s?.paidAmount||0)&&u({amount:n,reason:t.trim()||void 0})},r=k.useMemo(()=>{if(!s)return[];const f=s.paidAmount,v=s.installmentAmount,l=[];return f>=v&&l.push({label:`-${v}`,value:v}),f>=100&&!l.some(b=>b.value===100)&&l.push({label:"-100",value:100}),f>=500&&!l.some(b=>b.value===500)&&l.push({label:"-500",value:500}),l.push({label:"All",value:f}),l.slice(0,4)},[s]);if(!s)return null;const A="#a855f7";return e.jsx($,{children:o&&e.jsx(j.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",onClick:c,children:e.jsxs(j.div,{initial:{scale:.95,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.95,opacity:0,y:20},transition:{type:"spring",duration:.5},className:"w-full max-w-md bg-card/95 backdrop-blur-xl rounded-2xl border border-amber-500/20 shadow-2xl shadow-amber-500/10 overflow-hidden",onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{className:"relative px-6 py-4 border-b border-border",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-amber-500/10 via-orange-500/10 to-red-500/10"}),e.jsxs("div",{className:"relative flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-xl bg-amber-500/20",children:e.jsx(B,{className:"w-5 h-5 text-amber-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Refund Payment"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.title})]})]}),e.jsx("button",{onClick:c,className:"p-2 rounded-xl hover:bg-muted transition-colors",children:e.jsx(F,{className:"w-5 h-5 text-muted-foreground"})})]})]}),e.jsxs("form",{onSubmit:a,className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsxs("svg",{className:"w-32 h-32 -rotate-90",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"42",fill:"none",className:"stroke-muted",strokeWidth:"8"}),e.jsx(j.circle,{cx:"50",cy:"50",r:"42",fill:"none",stroke:`${A}4d`,strokeWidth:"8",strokeLinecap:"round",strokeDasharray:`${d*2.64} 264`}),e.jsx(j.circle,{cx:"50",cy:"50",r:"42",fill:"none",stroke:h?"#ef4444":n>0?"#f59e0b":A,strokeWidth:"8",strokeLinecap:"round",initial:!1,animate:{strokeDasharray:`${N*2.64} 264`},transition:{duration:.3,ease:"easeOut"}})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsxs(j.span,{className:`text-2xl font-bold ${h?"text-red-500":"text-foreground"}`,initial:{scale:1.1},animate:{scale:1},children:[Math.round(N),"%"]},N),e.jsx("span",{className:"text-xs text-muted-foreground",children:"after refund"})]})]})}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-purple-500/10 border border-purple-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Amount Paid"})]}),e.jsx("span",{className:"text-sm font-medium text-purple-500",children:g(s.paidAmount)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Refund Amount"}),e.jsx(D,{type:"number",value:m,onChange:f=>p(f.target.value),placeholder:"0.00",min:"0",max:s.paidAmount,step:"0.01",className:"text-lg",autoFocus:!0}),e.jsx("div",{className:"flex gap-2",children:r.map(f=>e.jsx("button",{type:"button",onClick:()=>p(f.value.toString()),className:"flex-1 px-3 py-2 text-sm font-medium rounded-lg bg-amber-500/20 text-amber-600 dark:text-amber-400 hover:bg-amber-500/30 transition-colors",children:f.label},f.label))})]}),h&&e.jsxs(j.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"flex items-center gap-2 p-3 rounded-xl bg-red-500/20 border border-red-500/30",children:[e.jsx(J,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-red-600 dark:text-red-300",children:"Amount exceeds total paid"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Reason (Optional)"}),e.jsx(E,{value:t,onChange:f=>i(f.target.value),placeholder:"Why are you refunding?",rows:2})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(w,{type:"button",variant:"outline",onClick:c,className:"flex-1",children:"Cancel"}),e.jsxs(w,{type:"submit",disabled:n<=0||h,className:"flex-1 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-600 hover:to-orange-600",children:["Refund"," ",n>0&&g(n)]})]})]})]})})})}const ee=[{value:"card",label:"Card",icon:"ðŸ’³"},{value:"cash",label:"Cash",icon:"ðŸ’µ"},{value:"bank-transfer",label:"Bank Transfer",icon:"ðŸ¦"},{value:"mobile-wallet",label:"Mobile Wallet",icon:"ðŸ“±"},{value:"other",label:"Other",icon:"ðŸ“"}],ue=({isOpen:o,onClose:c,onSubmit:u,installment:s,accounts:g,defaultCurrency:m,formatCurrency:p,calculateBalance:t})=>{const i=g.filter(l=>l.isActive),[n,x]=k.useState({installmentId:"",amount:0,accountId:i[0]?.id||"",paymentMethod:"card",date:new Date().toISOString().split("T")[0],notes:""}),[N,d]=k.useState(!1);k.useEffect(()=>{o&&s&&(x({installmentId:s.id,amount:s.installmentAmount,accountId:s.linkedAccountId||i[0]?.id||"",paymentMethod:"card",date:new Date().toISOString().split("T")[0],notes:""}),d(!1))},[o,s,i]);const h=async()=>{!n.accountId||n.amount<=0||!s||(d(!0),await new Promise(l=>setTimeout(l,500)),u(n),d(!1),c())},a=s?s.totalAmount-s.paidAmount:0,r=s?s.paidAmount/s.totalAmount*100:0,A=i.find(l=>l.id===n.accountId),f=A?t(A.id):0,v=n.amount>f;return o?e.jsx($,{children:o&&e.jsxs(e.Fragment,{children:[e.jsx(j.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50",onClick:c}),e.jsx(j.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",duration:.5},onClick:l=>l.stopPropagation(),className:"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-[51] w-full max-w-md",children:e.jsxs("div",{className:"relative bg-card/95 backdrop-blur-xl rounded-3xl border border-border/50 shadow-2xl overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-32 bg-gradient-to-br from-purple-500/20 via-violet-500/10 to-transparent"}),e.jsxs("div",{className:"relative p-6 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-500/20 flex items-center justify-center",children:e.jsx(K,{className:"w-5 h-5 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Record Payment"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s?.title||"Installment Payment"})]})]}),e.jsx("button",{onClick:c,className:"w-8 h-8 rounded-full bg-muted/50 flex items-center justify-center hover:bg-muted transition-colors",children:e.jsx(F,{className:"w-4 h-4"})})]}),s&&e.jsxs("div",{className:"mt-4 p-4 rounded-xl bg-muted/30 border border-border/30",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Progress"}),e.jsxs("span",{className:"font-medium",children:[s.paidInstallments," ","of"," ",s.totalInstallments," ","payments"]})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx(j.div,{className:"h-full bg-gradient-to-r from-purple-500 to-violet-500",initial:{width:0},animate:{width:`${r}%`},transition:{duration:.5,delay:.2}})}),e.jsxs("div",{className:"flex justify-between text-xs mt-2",children:[e.jsxs("span",{className:"text-purple-400",children:[p(s.paidAmount)," ","paid"]}),e.jsxs("span",{className:"text-muted-foreground",children:[p(a)," ","remaining"]})]})]})]}),e.jsxs("div",{className:"relative p-6 pt-0 space-y-4 max-h-[50vh] overflow-y-auto",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Payment Amount"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground",children:m==="EGP"?"EÂ£":m==="USD"?"$":"â‚¬"}),e.jsx(D,{type:"number",value:n.amount||"",onChange:l=>x(b=>({...b,amount:parseFloat(l.target.value)||0})),className:"pl-10 text-lg font-semibold",placeholder:"0.00"})]}),s&&e.jsxs("button",{type:"button",onClick:()=>x(l=>({...l,amount:s.installmentAmount})),className:"text-xs text-purple-400 hover:text-purple-300",children:["Use installment amount:"," ",p(s.installmentAmount)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Pay From Account"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:i.slice(0,4).map(l=>{const b=t(l.id),C=n.accountId===l.id;return e.jsxs("button",{type:"button",onClick:()=>x(P=>({...P,accountId:l.id})),className:I("p-3 rounded-xl border text-left transition-all",C?"border-purple-500/50 bg-purple-500/10":"border-border/50 hover:border-border"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:l.color}}),e.jsx("span",{className:"text-sm font-medium truncate",children:l.name})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:p(b)})]},l.id)})}),v&&e.jsx("p",{className:"text-xs text-destructive",children:"Insufficient funds in selected account"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Payment Method"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:ee.map(l=>e.jsxs("button",{type:"button",onClick:()=>x(b=>({...b,paymentMethod:l.value})),className:I("px-3 py-2 rounded-lg border text-sm transition-all flex items-center gap-2",n.paymentMethod===l.value?"border-purple-500/50 bg-purple-500/10 text-purple-400":"border-border/50 hover:border-border"),children:[e.jsx("span",{children:l.icon}),e.jsx("span",{children:l.label})]},l.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Payment Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(D,{type:"date",value:n.date,onChange:l=>x(b=>({...b,date:l.target.value})),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Notes (Optional)"}),e.jsx(E,{value:n.notes,onChange:l=>x(b=>({...b,notes:l.target.value})),placeholder:"Any additional notes...",rows:2})]})]}),e.jsx("div",{className:"relative p-6 pt-4 border-t border-border/30",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(w,{variant:"outline",onClick:c,className:"flex-1",children:"Cancel"}),e.jsx(w,{onClick:h,disabled:!n.amount||!n.accountId||v||N,className:"flex-1 bg-gradient-to-r from-purple-500 to-violet-500 hover:from-purple-600 hover:to-violet-600 text-white border-0",children:N?e.jsx(j.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full"}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Record Payment"]})})]})})]})})]})}):null};export{de as I,ue as P,ce as a,me as b,xe as c};
